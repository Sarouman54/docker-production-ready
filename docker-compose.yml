services:
        api:
                image: docker-production-api:1.0
                deploy:
                        replicas: 3
                        restart_policy:
                                condition: on-failure
                        update_config:
                                parallelism: 1
                                delay: 10s
                ports: 
                        - "3000:3000"
                networks:
                        - app-net
                depends_on:
                        - db

        db:
                image: postgres:15-alpine
                deploy:
                        replicas: 1
                environment:
                        POSTGRES_USER: user
                        POSTGRES_PASSWORD: password
                        POSTGRES_DB: mydb
                volumes:
                        - db_data:/var/lib/postgresql/data
                networks: 
                        - app-net

volumes:
        db_data:

networks:
        app-net: